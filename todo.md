C√≥ th·ªÉ s·ª≠ d·ª•ng MCP Context7.

# üéØ M·ª•c ti√™u & vai tr√≤

* **M·ª•c ti√™u**: Website chia s·∫ª deck Anki (*.apkg), h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng, b√†i vi·∫øt h·ªçc t·∫≠p; t·∫£i nhanh, d·ªÖ t√¨m deck theo ch·ªß ƒë·ªÅ/ng√¥n ng·ªØ/c·∫•p ƒë·ªô.
* **Nh√≥m ng∆∞·ªùi d√πng**: Ng∆∞·ªùi Vi·ªát Nam.
* **Vai tr√≤ nh√≥m**:

  * **B·∫°n (PM/Content)**: m√¥ t·∫£ t√≠nh nƒÉng, n·ªôi dung, quy t·∫Øc.
  * **M√¨nh (Planner)**: ki·∫øn tr√∫c th√¥ng tin, backlog, th√¥ng s·ªë k·ªπ thu·∫≠t.
  * **VSCode Copilot (Thi c√¥ng)**: scaffold code theo prompt.

---

# üó∫Ô∏è Ki·∫øn tr√∫c th√¥ng tin (IA)

**ƒê∆∞·ªùng d·∫´n ch√≠nh**

* `/` Trang ch·ªß
* `/decks` Danh m·ª•c deck (l·ªçc, t√¨m ki·∫øm)
* `/decks/[slug]` Trang chi ti·∫øt deck (m√¥ t·∫£, ·∫£nh, n√∫t t·∫£i)
* `/guides` H∆∞·ªõng d·∫´n (b√†i vi·∫øt MDX)
* `/blog` B√†i vi·∫øt c·∫≠p nh·∫≠t
* `/submit` G·ª≠i deck (form - giai ƒëo·∫°n 2) - D·ª± ƒë·ªãnh d√πng Google Form
* `/about` Gi·ªõi thi·ªáu / li√™n h·ªá

**ƒêi·ªÅu h∆∞·ªõng**

* Header: Logo ‚Ä¢ B·ªô th·∫ª ‚Ä¢ H∆∞·ªõng d·∫´n ‚Ä¢ Blog ‚Ä¢ Upload ‚Ä¢ Gi·ªõi thi·ªáu
* Footer: Li√™n h·ªá, License, RSS, Sitemap, Social

---

# üß± C√¥ng ngh·ªá & Integration

* **Astro minimal** (hi·ªán c√≥)
* **Tailwind**: `npx astro add tailwind`
* **MDX**: `npx astro add mdx`
* **Collections (astro****:content****)** cho deck/guides/blog
* **SEO**: `@astrojs/sitemap`, robots.txt, OpenGraph, JSON-LD
* **Icon**: `astro-icon` ho·∫∑c `@iconify-json` (t√πy)
* **Search/Filter**: Island (Astro + nh·ªè React/Vue optional)
* **·∫¢nh**: `@astrojs/image` (t√πy ch·ªçn)
* **Tri·ªÉn khai**: **Cloudflare Pages** (∆∞u ti√™n). *T·∫†M TH·ªúI kh√¥ng d√πng `ankivn.com` hay subdomain; ch·ªâ ch·∫°y b·∫±ng URL `*.pages.dev` cho ƒë·∫øn khi b·∫°n c·∫Øt kh·ªèi GH Pages.*
* **Ph√¢n t√≠ch**: Simple Analytics/Umami + Google Analytics(t√πy)

---

# üì¶ M√¥ h√¨nh n·ªôi dung (Content Collections)

## 1) Decks (`src/content/decks/`)

**File**: `*.md` ho·∫∑c `*.mdx`

**Frontmatter schema (√Ω nghƒ©a)**:

* `title`, `slug`
* `category`: m·ªôt trong c√°c nh√≥m ch√≠nh:

  * `T·∫•t c·∫£` | `Ngo·∫°i ng·ªØ` | `Gi√°o d·ª•c` | `Chuy√™n ng√†nh` | `M·∫´u th·∫ª` | `Add-ons` | `Kh√°c`
* `subCategory`: theo `category` (xem b·∫£ng taxonomy b√™n d∆∞·ªõi)
* `size`: s·ªë th·∫ª (notes)
* `date`: ISO date (thay cho `version`/`updated`)
* `author`: t√™n t√°c gi·∫£/nh√≥m
* `tags`: m·∫£ng string
* `cover`: ·∫£nh cover (1 ·∫£nh ƒë·∫°i di·ªán)
* `previews`: m·∫£ng ·∫£nh preview (0..n ·∫£nh minh h·ªça; c√≥ th·ªÉ l√† ·∫£nh c·ªßa t√°c gi·∫£ ho·∫∑c ·∫£nh ch·ª•p m√†n h√¨nh t·ª´ AnkiVN)
* `downloads`: **2 lo·∫°i link ch√≠nh** + mirror t√πy ch·ªçn

  * `author`: link g·ªëc c·ªßa t√°c gi·∫£
  * `ankivn`: link reup c·ªßa AnkiVN
  * `r2` | `gdrive` | `firebase` | `onedrive`: mirror th√™m (n·∫øu c√≥)

**N·ªôi dung th√¢n**: m√¥ t·∫£ deck, c·∫•u tr√∫c note, h∆∞·ªõng d·∫´n import, ngu·ªìn.

**Taxonomy chi ti·∫øt**:

* `Ngo·∫°i ng·ªØ` ‚Üí `Ti·∫øng Anh`, `Ti·∫øng Nh·∫≠t`, `Ti·∫øng Trung`, `Ti·∫øng H√†n`, `Ti·∫øng Ph√°p`, `Ti·∫øng ƒê·ª©c`, `Ti·∫øng Nga`
* `Gi√°o d·ª•c` ‚Üí `THCS`, `THPT`, `ƒê·∫°i h·ªçc`
* `Chuy√™n ng√†nh` ‚Üí `Y D∆∞·ª£c`, `C√¥ng ngh·ªá th√¥ng tin`, `Kinh t·∫ø`
* `M·∫´u th·∫ª` ‚Üí (t√πy ch·ªçn sau)
* `Add-ons` ‚Üí (t√πy ch·ªçn sau)
* `Kh√°c` ‚Üí (t·ªïng h·ª£p)

## 2) Guides (`src/content/guides/`)

* **Khuy·∫øn ngh·ªã ƒë·ªãnh d·∫°ng**: **MDX** (d·ªÖ vi·∫øt n·ªôi dung d√†i, ch√®n ·∫£nh/code; c√≥ th·ªÉ import component Astro khi c·∫ßn). Ch·ªâ d√πng `.astro` n·∫øu guide c·∫ßn b·ªë c·ª•c ƒë·ªông/logic ƒë·∫∑c th√π tr√™n trang.
* **Frontmatter**: `title`, `slug`, `tags`, `guideType` (`C∆° b·∫£n` | `N√¢ng cao` | `Tips`)
* **Th√¢n**: MDX (ch√®n code, h√¨nh)

## 3) Blog (`src/content/blog/`)  (`src/content/blog/`)

* **Frontmatter**: `title`, `slug`, `date`, `tags`, `summary`, `cover`
* **T√¨m ki·∫øm**: th√™m `BlogSearch.jsx` (island) ƒë·ªÉ t√¨m theo `title`/`tags`/`summary`

---

# üóÇÔ∏è C·∫•u tr√∫c th∆∞ m·ª•c ƒë·ªÅ xu·∫•t

```
.
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ covers/
‚îÇ   ‚îî‚îÄ‚îÄ favicon.svg
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ content/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guides/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ blog/
‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BaseLayout.astro
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PostLayout.astro
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeckLayout.astro
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Nav.astro
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Footer.astro
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TagCloud.astro
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SearchInput.jsx      // island
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeckCard.astro
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeckFilters.jsx      // island
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DownloadButton.astro
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guides/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GuideCard.astro
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blog/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BlogCard.astro
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ etc/
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ index.astro
‚îÇ       ‚îú‚îÄ‚îÄ decks.astro
‚îÇ       ‚îú‚îÄ‚îÄ decks/[slug].astro
‚îÇ       ‚îú‚îÄ‚îÄ guides.astro
‚îÇ       ‚îú‚îÄ‚îÄ blog.astro
‚îÇ       ‚îú‚îÄ‚îÄ submit.astro
‚îÇ       ‚îî‚îÄ‚îÄ about.astro
‚îú‚îÄ‚îÄ astro.config.mjs
‚îî‚îÄ‚îÄ package.json
```

---

# üß© Th√†nh ph·∫ßn (Components)

* **common/**: `Nav`, `Footer`, `TagCloud`, `SearchInput`, `CopyLinkButton.astro`
* **decks/**: `DeckCard`, `DeckFilters` (island), `DownloadButton`, `ImageViewer.jsx`
* **guides/**: `GuideCard`
* **blog/**: `BlogCard`, `BlogSearch.jsx` (island)
* **etc/**: th√†nh ph·∫ßn ch∆∞a ph√¢n lo·∫°i (di chuy·ªÉn d·∫ßn v√†o c√°c nh√≥m tr√™n)

---

# üîé T√¨m ki·∫øm & l·ªçc (Giai ƒëo·∫°n 1 ‚Äî client side)

* N·∫°p t·∫•t c·∫£ meta deck t·ª´ `astro:content`
* Filter client b·∫±ng JS (island) theo: `q` (title+tags), `category`, `subCategory`, `tags`; sort `date` (m·ªõi‚Üíc≈©) ho·∫∑c `size`
* H·ªó tr·ª£ query param: `?q=...&category=Ngo·∫°i ng·ªØ&sub=Ti·∫øng H√†n&sort=date`

> Giai ƒëo·∫°n 2: chuy·ªÉn sang t√¨m ki·∫øm server (Edge) n·∫øu s·ªë deck l·ªõn.

---

# ‚òÅÔ∏è L∆∞u tr·ªØ file .apkg

* **Ban ƒë·∫ßu**: Google Drive (nhanh tri·ªÉn khai)
* **Sau**: R2/BunnyCDN/OneDrive mirror ƒë·ªÉ t·ªëi ∆∞u bƒÉng th√¥ng
* **Quy ∆∞·ªõc link t·∫£i**:

  * `downloads.author` ‚Üí link g·ªëc c·ªßa t√°c gi·∫£
  * `downloads.ankivn` ‚Üí link reup do AnkiVN l∆∞u tr·ªØ
  * `downloads.r2`/`downloads.gdrive`/`downloads.firebase`/`downloads.onedrive` ‚Üí mirror ph·ª• (t√πy ch·ªçn)

---

# üñºÔ∏è H√¨nh ·∫£nh deck: ngu·ªìn & quy t·∫Øc

**M·ª•c ti√™u**: lu√¥n c√≥ **cover** ƒë·∫πp (1 ·∫£nh) v√† **hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß** ·∫£nh trong body ƒë·ªÉ ng∆∞·ªùi d√πng h√¨nh dung tr∆∞·ªõc khi t·∫£i.

**Ngu·ªìn ·∫£nh (∆∞u ti√™n theo th·ª© t·ª±)**

1. **T√°c gi·∫£ cung c·∫•p**: s·ª≠ d·ª•ng ·∫£nh g·ªëc n·∫øu r√µ n√©t.
2. **AnkiVN t·ª± ch·ª•p**: ch·ª•p m√†n h√¨nh nhi·ªÅu th·∫ª ti√™u bi·ªÉu (front/back, c·∫•u tr√∫c, mobile/desktop).
3. **Cover t·ª± sinh** (fallback): render ·∫£nh b√¨a b·∫±ng template (SVG/Canvas).

**Khai b√°o ·∫£nh**

* **D√πng Markdown trong ph·∫ßn body** v√† **link tuy·ªát ƒë·ªëi** t·ªõi ·∫£nh (CDN ho·∫∑c ngu·ªìn ngo√†i). V√≠ d·ª•:

  `![Front card](https://cdn.ankivn.vn/decks/{slug}/previews/full/front-01.webp)`

* Kh√¥ng gi·ªõi h·∫°n s·ªë ·∫£nh. Th·ª© t·ª± hi·ªÉn th·ªã = th·ª© t·ª± Markdown.

* `cover` trong frontmatter ch·ªâ ph·ª•c v·ª• thumbnail ·ªü danh s√°ch.

**L∆∞u tr·ªØ & quy ∆∞·ªõc**

* Khuy·∫øn ngh·ªã CDN: `https://cdn.ankivn.vn/decks/{slug}/...`
* C·∫•u tr√∫c g·ª£i √Ω: `previews/full/*.webp`

**Tr·∫£i nghi·ªám xem ·∫£nh**

* Trang chi ti·∫øt d√πng **ImageViewer**:

  * M·ªü ·∫£nh to√†n m√†n h√¨nh, **zoom/pan**, **ph√≠m ‚Üê/‚Üí**, **esc** ƒë·ªÉ ƒë√≥ng.
  * Lazy-load ·∫£nh theo th·ª© t·ª± Markdown.
  * Hi·ªÉn th·ªã **caption** t·ª´ alt text n·∫øu c√≥.

**Ph√°p l√Ω & ghi ngu·ªìn**

* N·∫øu ·∫£nh c·ªßa **t√°c gi·∫£**: ghi ngu·ªìn trong body/footnote.
* N·∫øu ·∫£nh **AnkiVN ch·ª•p**: ghi ‚ÄúScreenshots ¬© AnkiVN‚Äù.

---

# üßæ SEO & Metadata

* **Site URL**: **t·∫°m th·ªùi ƒë·ªÉ tr·ªëng** (build b·∫±ng `*.pages.dev`). Khi c·∫Øt kh·ªèi GH Pages s·∫Ω ƒë·∫∑t `site` l√† domain ch√≠nh.
* Sitemap, robots, canonical
* OG tags: `og:title`, `og:description`, `og:image`
* JSON-LD cho Deck: `@type: CreativeWork` ho·∫∑c `Dataset`
* Th·∫ª meta i18n (sau): `hreflang`

---

# üß™ Ch·∫•t l∆∞·ª£ng & A11y

* Ki·ªÉm tra Lighthouse ‚â• 90
* Text t∆∞∆°ng ph·∫£n, tab order, alt cho ·∫£nh
* Ki·ªÉm th·ª≠ mobile (<= 360px)

---

# üß≠ Wireframe nhanh

## / (Home)

```
[Logo]  B·ªô th·∫ª | H∆∞·ªõng d·∫´n | Blog | Upload | Gi·ªõi thi·ªáu
-------------------------------------------------
Hero: "Anki Vi·ªát Nam"
[SearchInput]
[decks] [guides] [blog] [upload]
Footer
```

## /decks

```
Title + m√¥ t·∫£ ng·∫Øn
[DeckFilters]
[DeckCard]*
Pagination (n·∫øu c·∫ßn)
```

## /decks/[slug]

```
Breadcrumb
Title + Date
Cover (gallery)
M√¥ t·∫£ deck (MDX)
Th√¥ng tin: size, notes 
[DownloadButton]
Li√™n quan: DeckCard*
```

---

# üìù Schema Zod cho Collections (m·∫´u)

```ts
// src/content/config.ts
import { z, defineCollection } from 'astro:content';

const categoryEnum = z.enum([
  'T·∫•t c·∫£','Ngo·∫°i ng·ªØ','Gi√°o d·ª•c','Chuy√™n ng√†nh','M·∫´u th·∫ª','Add-ons','Kh√°c'
]);

const subCategoryEnum = z.enum([
  // Ngo·∫°i ng·ªØ
  'Ti·∫øng Anh','Ti·∫øng Nh·∫≠t','Ti·∫øng Trung','Ti·∫øng H√†n','Ti·∫øng Ph√°p','Ti·∫øng ƒê·ª©c','Ti·∫øng Nga',
  // Gi√°o d·ª•c
  'THCS','THPT','ƒê·∫°i h·ªçc',
  // Chuy√™n ng√†nh
  'Y D∆∞·ª£c','C√¥ng ngh·ªá th√¥ng tin','Kinh t·∫ø'
]);

const previewKindEnum = z.enum(['front','back','config','overview','other']);

const decks = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    slug: z.string(),
    category: categoryEnum,
    subCategory: subCategoryEnum.optional(),
    size: z.number(),
    date: z.string(),
    author: z.string().optional(),
    tags: z.array(z.string()).default([]),
    cover: z.string().optional(),
    // `previews` gi·ªØ optional (kh√¥ng khuy·∫øn ngh·ªã d√πng khi ·∫£nh ƒë√£ ƒë·∫∑t trong body b·∫±ng Markdown)
    previews: z.array(z.object({
      src: z.string(),
      alt: z.string().optional(),
      caption: z.string().optional(),
      credit: z.string().optional(),
      kind: previewKindEnum.optional(),
      priority: z.number().optional(),
    })).optional(),
    downloads: z.object({
      author: z.string().url().optional(),
      ankivn: z.string().url().optional(),
      r2: z.string().url().optional(),
      gdrive: z.string().url().optional(),
      firebase: z.string().url().optional(),
      onedrive: z.string().url().optional(),
    }).partial()
  })
});

const guides = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    slug: z.string(),
    tags: z.array(z.string()).default([]),
    guideType: z.enum(['C∆° b·∫£n','N√¢ng cao','Tips'])
  })
});

const blog = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    slug: z.string(),
    date: z.string(),
    tags: z.array(z.string()).default([]),
    summary: z.string().optional(),
    cover: z.string().optional()
  })
});

export const collections = { decks, guides, blog };
```

---

# üß∞ Backlog tri·ªÉn khai (Phase 1)

1. **C√†i ƒë·∫∑t**

   * `npx astro add tailwind`
   * `npx astro add mdx`
   * `npm i @astrojs/sitemap`
   * T·∫°o `src/content/config.ts` nh∆∞ tr√™n

2. **Layouts**

   * `BaseLayout.astro`: head (meta), Nav, Footer, slot
   * `PostLayout.astro`: cho guides/blog, hi·ªÉn th·ªã ng√†y, TOC (tu·ª≥ ch·ªçn)
   * `DeckLayout.astro`: b√≥c ·∫£nh t·ª´ **Markdown body** ‚Üí truy·ªÅn cho `ImageViewer`, v·∫´n h·ªó tr·ª£ `cover`

3. **Components**

   * `Nav.astro`, `Footer.astro`
   * `DeckCard.astro`
   * `DownloadButton.astro`
   * `DeckFilters.jsx` + `SearchInput.jsx` (island)
   * `ImageViewer.jsx` (new): full-screen, zoom/pan, keyboard nav; nh·∫≠n `images: {src,alt}[]`
   * `CopyLinkButton.astro` (new): copy canonical URL + UTM v√†o clipboard

4. **Pages**

   * `index.astro`: Hero + deck m·ªõi + tag cloud
   * `decks.astro`: list + filters
   * `decks/[slug].astro`: chi ti·∫øt deck (ƒë·ªçc ·∫£nh t·ª´ body + ImageViewer)

5. **N·ªôi dung m·∫´u**

   * T·∫°o 3 deck m·∫´u ·ªü `src/content/decks/*.md`
   * 1 guide: ‚ÄúC√°ch import deck .apkg tr√™n AnkiDroid‚Äù

6. **SEO/Build**

   * sitemap, robots
   * OG default images

7. **Deploy**

   * **Cloudflare Pages**: K·∫øt n·ªëi repo GitHub ‚Üí build `npm run build`, output `dist/` ‚Üí d√πng URL `*.pages.dev` ƒë·ªÉ QA v√† ch·∫°y t·∫°m th·ªùi.
   * **Kh√¥ng c·∫•u h√¨nh domain `ankivn.com` v√† kh√¥ng t·∫°o subdomain** ·ªü giai ƒëo·∫°n n√†y.

---

# üí¨ Prompt g·ª£i √Ω cho Copilot (copy d√πng ngay)

**T·∫°o DeckLayout b√≥c ·∫£nh t·ª´ Markdown**

```
Create `src/layouts/DeckLayout.astro` that:
- Receives `content` (Markdown/MDX) and frontmatter (`title`, `date`, `cover`, etc.).
- Parses rendered HTML of `content` to collect all `<img>` elements (absolute URLs required).
- Builds an `images` array: `{ src, alt }[]` in DOM order.
- Renders the content normally.
- Renders <ImageViewer images={images}/> under the content.
```

**T·∫°o ImageViewer.jsx**

```
Create `src/components/decks/ImageViewer.jsx` (island) that accepts `images: {src:string, alt?:string}[]` and renders:
- All images as a grid (no limit) with lazy-loading.
- On click, open a full-screen modal with zoom (wheel/pinch), pan (drag), next/prev (‚Üê/‚Üí), close (Esc/click overlay).
- Keep URL hash like `#image-5` for deep-linking.
```

**T·∫°o CopyLinkButton.astro (common)**

```
Create `src/components/common/CopyLinkButton.astro` with a single button that copies the canonical page URL (plus optional `utm` query) to clipboard using the Clipboard API. Show success toast. Props: `url:string`, `utm?:string`, `label?:string` (default: "Copy link").
```

**Trang /decks/[slug]**

```
Update deck detail to place <CopyLinkButton url={canonicalUrl} utm="?utm_source=copy&utm_medium=deck&utm_campaign=ankivn"/> near title.
```

**G·ª£i √Ω Markdown cho ·∫£nh c·ªßa t√°c gi·∫£**

```
Trong file `src/content/decks/{slug}.mdx`, ch√®n ·∫£nh b·∫±ng link tuy·ªát ƒë·ªëi:

![Front 1](https://cdn.ankivn.vn/decks/{slug}/previews/full/front-01.webp)
![Back 1](https://cdn.ankivn.vn/decks/{slug}/previews/full/back-01.webp)
![Config](https://cdn.ankivn.vn/decks/{slug}/previews/full/config-01.webp)
```

---

# ‚úÖ To‚ÄëDo (g·ªôp 1 m·∫°ch: **T·ªïng quan ‚Üí Chi ti·∫øt ‚Üí C·ª• th·ªÉ ho√°**)

> Ch·ªâ c√≤n **m·ªôt** khu v·ª±c To‚ÄëDo duy nh·∫•t. ƒêi theo th·ª© t·ª± t·ª´ tr√™n xu·ªëng. Copy c√°c prompt d√°n v√†o Copilot/Copilot Agents.

---

## I) **T·ªïng quan (Milestones)**

1. **A. Kh·ªüi t·∫°o & C·∫•u h√¨nh** ‚Äî Tailwind, MDX, sitemap, schemas.
2. **B. Layouts c·ªët l√µi** ‚Äî BaseLayout, PostLayout, DeckLayout (tr√≠ch <img> t·ª´ body).
3. **C. Components ch·ª©c nƒÉng** ‚Äî Nav/Footer, DeckCard, DeckFilters, DownloadButton, ImageViewer, CopyLinkButton, BlogSearch.
4. **D. Pages** ‚Äî `/`, `/decks`, `/decks/[slug]`, `/guides`, `/blog`.
5. **E. N·ªôi dung m·∫´u** ‚Äî 3 deck m·∫´u (·∫£nh tuy·ªát ƒë·ªëi trong body), 1 guide + 1 blog.
6. **F. SEO/Build/Deploy** ‚Äî sitemap, robots, canonical, OG fallback, **Cloudflare Pages**.
7. **G. QA** ‚Äî Lighthouse ‚â• 90, A11y & mobile.

---

## II) **Chi ti·∫øt (Epics ‚Üí Tasks)**

### A ‚Äî Kh·ªüi t·∫°o & C·∫•u h√¨nh

* A1. C√†i Tailwind + MDX + `@astrojs/sitemap` (site URL).
* A2. T·∫°o `src/content/config.ts` (Decks/Guides/Blog) ƒë√∫ng spec.
* A3. S·ª≠a `astro.config.mjs` (markdown, aliases, sitemap).

### B ‚Äî Layouts c·ªët l√µi

* B1. BaseLayout: meta/OG, skip-link, container, Nav/Footer.
* B2. PostLayout: title/date, optional TOC.
* B3. DeckLayout: render body, **thu th·∫≠p T·∫§T C·∫¢ `<img>`** theo th·ª© t·ª± Markdown ‚Üí `ImageViewer`.

### C ‚Äî Components ch·ª©c nƒÉng

* C1. Nav/Footer: responsive + a11y.
* C2. DeckCard: title/cover/date/size/category/subCategory.
* C3. DeckFilters (island): q + category/subCategory + tags; sort date/size; sync URL.
* C4. DownloadButton: author/ankivn/r2/gdrive/firebase/onedrive.
* C5. ImageViewer (island): grid + modal full-screen; zoom/pan; ‚Üê/‚Üí; Esc; lazy; hash deep‚Äëlink.
* C6. CopyLinkButton: copy canonical URL (+utm) v·ªõi toast.
* C7. BlogSearch (island): search title/summary/tags; query sync.

### D ‚Äî Pages

* D1. `/` (Home): hero + l·ªëi t·∫Øt.
* D2. `/decks`: t·∫£i meta ‚Üí DeckFilters ‚Üí DeckCard list.
* D3. `/decks/[slug]`: DeckLayout + DownloadButton + CopyLinkButton.
* D4. `/guides` + `/blog`: list + detail v·ªõi PostLayout; g·∫Øn BlogSearch ·ªü `/blog`.

### E ‚Äî N·ªôi dung m·∫´u

* E1. 3 deck m·∫´u (·∫£nh **absolute** trong body, nhi·ªÅu ·∫£nh tho·∫£i m√°i).
* E2. 1 guide (C∆° b·∫£n) + 1 blog (cover + summary).

### F ‚Äî SEO/Build/Deploy

* F1. Sitemap/robots/canonical (**ch∆∞a set `site`**; c·∫≠p nh·∫≠t sau khi c√≥ domain ch√≠nh ho·∫∑c pages.dev ·ªïn ƒë·ªãnh).
* F2. `/api/og/[slug].ts` ‚Äî OG fallback khi thi·∫øu cover.
* F3. **Deploy Cloudflare Pages** (k·∫øt n·ªëi GitHub, build, d√πng `*.pages.dev`, **kh√¥ng g·∫Øn domain**).
* F4. **_headers & _redirects** (SPA rewrite; **kh√¥ng** th√™m redirect domain l√∫c n√†y).

### G ‚Äî QA

* G1. Lighthouse mobile ‚â• 90.
* G2. A11y & mobile (keyboard, focus, alt, ‚â§360px).

---

## III) **C·ª• th·ªÉ ho√° (Prompts ƒë·ªÉ Copilot l√†m vi·ªác)**

> D√°n tr·ª±c ti·∫øp c√°c ƒëo·∫°n d∆∞·ªõi ƒë√¢y cho Copilot. M·ªói ƒëo·∫°n ho√†n th√†nh in ra: `[DONE <ID>]` + files changed.

### A ‚Äî Kh·ªüi t·∫°o & C·∫•u h√¨nh

**A1.**

```
Run: npx astro add tailwind && npx astro add mdx && npm i @astrojs/sitemap
Then set Tailwind content paths to src/**/*.{astro,jsx,tsx,md,mdx}. Create tailwind.config.mjs and postcss.config.cjs.
```

**A2.**

```
Create src/content/config.ts with Decks/Guides/Blog schemas exactly as in the plan (category, subCategory, size, date, cover, downloads...). Run `astro check` and report diagnostics.
```

**A3.**

```
Update astro.config.mjs: enable sitemap plugin but read `site` from env (e.g., process.env.SITE_URL). For now, DO NOT set SITE_URL; optionally disable sitemap generation if SITE_URL is missing. Add path aliases (@/components, @/content).
```

Update astro.config.mjs: set `site` to [https://ankivn.com](https://ankivn.com), enable sitemap, tune markdown/MDX options, add path aliases (@/components, @/content).

```

### B ‚Äî Layouts c·ªët l√µi
**B1.**
```

Create src/layouts/BaseLayout.astro with <Nav/> <Footer/> <slot/>, meta/OG defaults, skip-link a11y, responsive container.

```
**B2.**
```

Create src/layouts/PostLayout.astro for guides/blog with title, date, optional TOC.

```
**B3.**
```

Implement src/layouts/DeckLayout.astro: render MDX body, parse ALL <img> elements in DOM order, build images[] = {src,alt}, pass to <ImageViewer images={images}/>; no image limit.

```

### C ‚Äî Components ch·ª©c nƒÉng
**C1.**
```

Create src/components/common/Nav.astro and Footer.astro (responsive, accessible, active states, footer links incl. RSS/sitemap/contact).

```
**C2.**
```

Create src/components/decks/DeckCard.astro with props {title, cover, date, size, category, subCategory, href}. Fallback cover `/api/og/{slug}` when missing.

```
**C3.**
```

Create src/components/decks/DeckFilters.jsx: search title+tags, filter category/subCategory/tags, sort date/size; sync state‚Üîquery params. Debounce typing.

```
**C4.**
```

Create src/components/decks/DownloadButton.astro supporting links: author, ankivn, r2, gdrive, firebase, onedrive. target=_blank rel=noopener.

```
**C5.**
```

Create src/components/decks/ImageViewer.jsx (island): grid all images; modal full-screen with zoom/pan, ‚Üê/‚Üí, Esc; lazy-load; maintain hash `#image-i` for deep-link.

```
**C6.**
```

Create src/components/common/CopyLinkButton.astro: copy canonical URL (+optional utm) using Clipboard API; show toast on success.

```
**C7.**
```

Create src/components/blog/BlogSearch.jsx: filter posts by title/summary/tags; sync `?q=&tags=`; show result count; debounce.

```

### D ‚Äî Pages
**D1.**
```

Create src/pages/index.astro with hero and quick links to decks/guides/blog/upload.

```
**D2.**
```

Create src/pages/decks.astro that loads Decks collection, feeds <DeckFilters/>, and renders <DeckCard/> list. Keep URL query in sync.

```
**D3.**
```

Create src/pages/decks/[slug].astro using <DeckLayout/>, show title/date/size/category/subCategory/tags, <DownloadButton downloads={...}/>, and <CopyLinkButton url={canonicalUrl} utm="?utm_source=copy&utm_medium=deck&utm_campaign=ankivn"/>.

```
**D4.**
```

Create /guides and /blog list pages loading from collections; detail pages use <PostLayout/>; attach <BlogSearch/> to /blog.

```

### E ‚Äî N·ªôi dung m·∫´u
**E1.**
```

Create three sample deck MDX files under src/content/decks with absolute image URLs in body (several images) and realistic downloads.

```
**E2.**
```

Create one sample guide (guideType="C∆° b·∫£n") and one blog post (summary + cover).

```

### F ‚Äî SEO/Build/Deploy (**Cloudflare Pages**)
**F1.**
```

Configure sitemap and add a static robots.txt; ensure canonical tags per page.

```
**F2.**
```

Create /api/og/[slug].ts that renders OG image when a deck has no cover.

```
**F3.**
```

Create a new Cloudflare Pages project connected to this GitHub repo.
Settings:

* Build: npm run build
* Output: dist
* Node: 18+
* Custom domain: SKIP (do not attach ankivn.com yet)
  After deployment, print the assigned *.pages.dev URL.

```
Create a new Cloudflare Pages project connected to this GitHub repo.
Settings:
- Build: npm run build
- Output: dist
- Node: 18+
- Custom domain: ankivn.com (301 www‚Üíapex)
- SSL/TLS: Full (Strict if possible)
- Always Use HTTPS: ON
After deployment, print the *.pages.dev URL.
```

**F4.**

```
Add `_headers` and `_redirects` at repo root for SPA only (no domain redirects yet):

_redirects
/*  /index.html  200

_headers
/*
  X-Frame-Options: DENY
  X-Content-Type-Options: nosniff
  Referrer-Policy: strict-origin-when-cross-origin
  Permissions-Policy: geolocation=(), microphone=(), camera=()
  Strict-Transport-Security: max-age=31536000
  Cache-Control: public, max-age=600

/assets/*
  Cache-Control: public, max-age=31536000, immutable

/images/*
  Cache-Control: public, max-age=31536000, immutable
```

Add `_headers` and `_redirects` at repo root:

_redirects
/*  /index.html  200
[https://www.ankivn.com/](https://www.ankivn.com/)*  [https://ankivn.com/:splat](https://ankivn.com/:splat)  301

_headers
/*
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=(), camera=()
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
Cache-Control: public, max-age=600

/assets/*
Cache-Control: public, max-age=31536000, immutable

/images/*
Cache-Control: public, max-age=31536000, immutable

```

### G ‚Äî QA
**G1.**
```

Run Lighthouse on mobile and optimize until Performance/SEO/Best Practices ‚â• 90.

```
**G2.**
```

Run a11y checks (keyboard nav, focus ring, alt text). Verify small-screen (‚â§360px) layout.

```

---

## üß≠ Macro‚ÄëPrompt (ch·∫°y tu·∫ßn t·ª± to√†n b·ªô)
```

You are Copilot Agent. Execute milestones in order: A‚ÜíB‚ÜíC‚ÜíD‚ÜíE‚ÜíF‚ÜíG and within each milestone follow numbered tasks. After each task, print: [DONE <ID>] and list files changed. If a dependency is missing, pause and ask.

```

## üîÅ K·∫ø ho·∫°ch tri·ªÉn khai hi·ªán t·∫°i (ch·ªâ `*.pages.dev`)
1) Deploy Cloudflare Pages ‚Üí d√πng URL `*.pages.dev` ƒë·ªÉ QA v√† ch·∫°y th·ª±c t·∫ø.
2) **KH√îNG** c·∫•u h√¨nh `ankivn.com` l√∫c n√†y; **KH√îNG** t·∫°o b·∫•t k·ª≥ subdomain n√†o.
3) Khi b·∫°n quy·∫øt ƒë·ªãnh ng·∫Øt GH Pages, s·∫Ω b·ªï sung checklist cutover domain ri√™ng.

## üß≠ Macro‚ÄëPrompt (ch·∫°y tu·∫ßn t·ª± to√†n b·ªô)
```

You are Copilot Agent. Execute milestones in order: A‚ÜíB‚ÜíC‚ÜíD‚ÜíE‚ÜíF‚ÜíG and within each milestone follow numbered tasks. After each task, print: [DONE <ID>] and list files changed. If a dependency is missing, pause and ask.

```

## ‚úÖ Definition of Done & Checklist ph√°t h√†nh
- DoD: build ok (`npm run dev`), kh√¥ng l·ªói; deck images hi·ªÉn th·ªã **t·∫•t c·∫£**; filters & URL sync; copy link ok; SEO (sitemap/robots/canonical/OG) ok; Lighthouse mobile ‚â• 90.
- Checklist:
  - [ ] 3 deck sample hi·ªÉn th·ªã ƒë·ªß ·∫£nh body.
  - [ ] T·∫•t c·∫£ link download 200 OK.
  - [ ] Canonical + OG h·ª£p l·ªá (cover ho·∫∑c OG fallback).
  - [ ] **Cloudflare Pages** ho·∫°t ƒë·ªông t·ªët tr√™n URL `*.pages.dev` (kh√¥ng domain).
  - [ ] `_headers` & `_redirects` c√≥ hi·ªáu l·ª±c (ki·ªÉm tra response headers).
  - [ ] Re-run Lighthouse, ghi l·∫°i ch·ªâ s·ªë.

```
