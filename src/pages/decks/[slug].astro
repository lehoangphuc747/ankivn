---
import DeckLayoutEnhanced from '@/layouts/DeckLayoutEnhanced.astro';
import CopyLinkButton from '@/components/common/CopyLinkButton.astro';
import DownloadButton from '@/components/decks/DownloadButton.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const decks = await getCollection('decks');
  return decks.map((d) => ({ params: { slug: d.slug } }));
}

const { slug } = Astro.params;
const deck = (await getCollection('decks')).find((d) => d.slug === slug);
if (!deck) throw new Error('Deck not found');
const canonicalUrl = new URL(Astro.url.pathname, Astro.url.origin).toString();
const { Content } = await deck.render();
---
<DeckLayoutEnhanced 
  title={deck.data.title} 
  date={deck.data.date} 
  cover={deck.data.cover}
  category={deck.data.category}
  subCategory={deck.data.subCategory}
  tags={deck.data.tags}
  author={deck.data.author}
  authorLink={deck.data.authorLink}
  previewImages={deck.data.previewImages || []}
>
  <Content />
  
  <!-- Main Actions Section - Single Download Location -->
  <div slot="actions">
    <DownloadButton downloads={deck.data.downloads} />
  </div>
</DeckLayoutEnhanced>
